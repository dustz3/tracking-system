doctype html
html(lang="zh-TW")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title API 調試頁面
    style.
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success { background: #d4edda; border-color: #c3e6cb; }
      .error { background: #f8d7da; border-color: #f5c6cb; }
      .loading { background: #fff3cd; border-color: #ffeaa7; }
      button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background: #007bff;
        color: white;
      }
      button:hover { background: #0056b3; }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        overflow-x: auto;
      }
  
  body
    .container
      h1 🔍 API 調試頁面
      
      .test-section
        h3 本地 API 測試
        button(onclick="testLocalAPI()") 測試本地 API
        #localResult
      
      .test-section
        h3 遠程 API 測試
        button(onclick="testRemoteAPI()") 測試遠程 API
        #remoteResult
      
      .test-section
        h3 追蹤查詢測試
        input#trackingInput(type="text" placeholder="輸入追蹤號碼" value="TM-24070101")
        button(onclick="testTrackingQuery()") 測試查詢
        #trackingResult
    
    script.
      async function testLocalAPI() {
        const resultDiv = document.getElementById('localResult');
        resultDiv.innerHTML = '<div class="loading">測試中...</div>';
        
        try {
          const response = await fetch('http://localhost:3001/api/test-connection');
          const data = await response.json();
          
          if (response.ok) {
            resultDiv.innerHTML = `<div class="success">
              <h4>✅ 本地 API 正常</h4>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>`;
          } else {
            resultDiv.innerHTML = `<div class="error">
              <h4>❌ 本地 API 錯誤</h4>
              <pre>狀態: ${response.status}\n${JSON.stringify(data, null, 2)}</pre>
            </div>`;
          }
        } catch (error) {
          resultDiv.innerHTML = `<div class="error">
            <h4>❌ 本地 API 連接失敗</h4>
            <pre>${error.message}</pre>
          </div>`;
        }
      }
      
      async function testRemoteAPI() {
        const resultDiv = document.getElementById('remoteResult');
        resultDiv.innerHTML = '<div class="loading">測試中...</div>';
        
        try {
          const response = await fetch('https://tracking-system-f6d5.onrender.com/api/test-connection');
          const data = await response.json();
          
          if (response.ok) {
            resultDiv.innerHTML = `<div class="success">
              <h4>✅ 遠程 API 正常</h4>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>`;
          } else {
            resultDiv.innerHTML = `<div class="error">
              <h4>❌ 遠程 API 錯誤</h4>
              <pre>狀態: ${response.status}\n${JSON.stringify(data, null, 2)}</pre>
            </div>`;
          }
        } catch (error) {
          resultDiv.innerHTML = `<div class="error">
            <h4>❌ 遠程 API 連接失敗</h4>
            <pre>${error.message}</pre>
          </div>`;
        }
      }
      
      async function testTrackingQuery() {
        const resultDiv = document.getElementById('trackingResult');
        const trackingId = document.getElementById('trackingInput').value;
        
        if (!trackingId) {
          resultDiv.innerHTML = '<div class="error">請輸入追蹤號碼</div>';
          return;
        }
        
        resultDiv.innerHTML = '<div class="loading">查詢中...</div>';
        
        try {
          const response = await fetch(`http://localhost:3001/api/search-tracking?trackingId=${encodeURIComponent(trackingId)}`);
          const data = await response.json();
          
          if (response.ok) {
            resultDiv.innerHTML = `<div class="success">
              <h4>✅ 查詢成功</h4>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </div>`;
          } else {
            resultDiv.innerHTML = `<div class="error">
              <h4>❌ 查詢失敗</h4>
              <pre>狀態: ${response.status}\n${JSON.stringify(data, null, 2)}</pre>
            </div>`;
          }
        } catch (error) {
          resultDiv.innerHTML = `<div class="error">
            <h4>❌ 查詢連接失敗</h4>
            <pre>${error.message}</pre>
          </div>`;
        }
      } 